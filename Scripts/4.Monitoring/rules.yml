groups:
- name: nodes
  rules:
  - alert: Node_exporter_down
    expr: up{job="nodes"} == 0
    for: 10s
    annotations:
      title: 'Node Exporter Down on { $labels.instance }} '
      description: 'Node Exporter Down on { $labels.instance }}'
    labels:
      severity: 'crit'

  - alert: High_CPU_utiluzation
    expr: node_load1{job="nodes"} > 0.9
    for: 1m
    annotations:
      title: 'High CPU utiluzation on { $labels.instance }}'
      description: 'High CPU utiluzation on { $labels.instance }}'
    labels:
      severity: 'crit'

  - alert: High_memory_utiluzation
    expr: ((node_memory_MemAvailable_bytes{job="nodes"} / node_memory_MemTotal_bytes{job="nodes"}) * 100) < 10
    for: 1m
    annotations:
      title: 'High memory utiluzation on { $labels.instance }}'
      description: 'High memory utiluzation on { $labels.instance }}'
    labels:
      severity: 'crit'

  - alert: Disc_space_problem
    expr: ((node_filesystem_avail_bytes{job="nodes", mountpoint="/",fstype!="rootfs"} / node_filesystem_size_bytes{job="nodes", mountpoint="/",fstype!="rootfs"}) * 100) < 10
    for: 10m
    annotations:
      title: 'Disk 90% full on { $labels.instance }}'
      description: 'Disk 90% full on { $labels.instance }}'
    labels:
      severity: 'crit'

  - alert: High_port_incoming_utilization
    expr: (rate(node_network_receive_bytes_total{job="nodes", device="eth0"}[5m]) / 1024 / 1024) > 150
    for: 5s
    annotations:
      title: 'High port input load on { $labels.instance }}'
      description: 'Incoming port load > 150 Mb/s on { $labels.instance }}'
    labels:
      severity: 'crit'

  - alert: High_port_outcoming_utilization
    expr: (rate(node_network_transmit_bytes_total{ job="nodes", device="eth0"}[5m]) / 1024 / 1024) > 150
    for: 5s
    annotations:
      title: High outbound port utilization on { $labels.instance }}
      description: 'Outcoming port load > 150 Mb/s on { $labels.instance }}'
    labels:
      severity: 'crit'
- name: vpn
  rules:
    - alert: Vpn_exporter_down
      expr: up{job="openvpn-metrics"} == 0
      for: 10s
      annotations:
        title: 'Vpn Exporter Down'
        description: 'Vpn Exporter Down'
      labels:
        severity: 'crit'

    - alert: VpnDown
      expr: openvpn_up == 0
      for: 10s
      annotations:
        title: 'VPN Service down'
        description: 'VPN Service down'
      labels:
        severity: 'crit'

    - alert: Vpn_NoClientConnected
      expr: openvpn_server_connected_clients == 0
      for: 10s
      annotations:
        title: 'No VPN Client Connected'
        description: 'No VPN Client Connected'
      labels:
        severity: 'crit'
